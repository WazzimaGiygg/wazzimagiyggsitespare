<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Carregando...</title>
<link rel="icon" href="favicom.png" type="image/x-icon" />
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.min.css" />
<style>
/* Seu CSS original, com pequenas correções */
body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  margin: 0;
  font-family: 'Roboto', sans-serif;
  background-color: #f5f5f5;
}
.mdl-layout__content {
  flex-grow: 1;
  display: flex;
  position: relative;
  padding: 0;
}
.page-content {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}
.mdl-layout__drawer .mdl-navigation .mdl-navigation__link {
  color: #424242;
}
.mdl-layout__drawer .mdl-navigation .mdl-navigation__link[data-requires-auth="true"] {
  color: #9e9e9e;
  pointer-events: none;
}
#main-content-frame {
  flex-grow: 1;
  border: none;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
}
#window-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1000;
  pointer-events: none;
}
#window-container > .floating-window {
  pointer-events: auto;
}
.floating-window {
  display: flex;
  flex-direction: column;
  position: absolute;
  min-width: 300px;
  min-height: 200px;
  background-color: white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  border-radius: 8px;
  overflow: hidden;
  resize: both;
  transition: transform 0.2s ease-out;
  border: 1px solid #ccc;
  top: 50px;
  left: 50px;
  z-index: 1000;
}
.window-header {
  cursor: grab;
  padding: 8px 12px;
  background-color: #f5f5f5;
  border-bottom: 1px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.window-header:active {
  cursor: grabbing;
}
.window-header span {
  font-weight: bold;
}
.window-controls button {
  border: none;
  background: none;
  font-size: 24px;
  cursor: pointer;
  color: #666;
  line-height: 1;
  padding: 0 8px;
}
.window-controls button:hover {
  color: #333;
}
.window-body {
  flex-grow: 1;
  overflow: hidden;
}
.window-body iframe {
  width: 100%;
  height: 100%;
  border: none;
}
.mdl-layout__header-row {
  padding: 0 16px;
}
.mdl-layout__header-row .mdl-navigation {
  display: flex;
  align-items: center;
}
.mdl-layout__header-row .mdl-navigation .mdl-navigation__link {
  padding: 0 12px;
}
#user-profile-pic {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  margin-left: 8px;
  vertical-align: middle;
  display: none;
}
#google-apps-button {
  display: none;
}
#google-apps-popup {
  display: none;
  position: absolute;
  top: 48px;
  right: 0;
  width: 300px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  z-index: 1000;
  padding: 10px;
  box-sizing: border-box;
}
#google-apps-popup h4 {
  margin-top: 0;
  margin-bottom: 10px;
  color: #3f51b5;
  text-align: center;
}
#app-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  padding: 10px;
}
.app-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  cursor: pointer;
  padding: 8px;
  border-radius: 4px;
  transition: background-color 0.3s;
}
.app-item:hover {
  background-color: #f0f0f0;
}
.app-item img {
  width: 48px;
  height: 48px;
  margin-bottom: 5px;
}
.app-item span {
  font-size: 0.8em;
  color: #555;
}
#access-denied-message, #banned-message {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #ffe0b2;
  border: 1px solid #ffb74d;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  text-align: center;
  color: #e65100;
  font-weight: bold;
  z-index: 1001;
}
#news-button {
  margin-right: 8px;
  display: none;
}
#news-center-popup {
  display: none;
  position: absolute;
  top: 48px;
  right: 0;
  width: 400px;
  max-height: 80vh;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  z-index: 998;
  flex-direction: column;
  overflow: hidden;
}
#news-popup-header {
  background-color: #3f51b5;
  color: white;
  padding: 10px 15px;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-weight: bold;
  font-size: 16px;
}
#news-popup-header .close-button {
  background: none;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  padding: 0;
}
#news-popup-content {
  flex-grow: 1;
  overflow-y: auto;
  padding: 15px;
}
#news-popup-footer {
  padding: 10px 15px;
  border-top: 1px solid #eee;
  text-align: center;
}
#news-popup-footer button {
  width: 100%;
}
.news-popup-item {
  background-color: #f9f9f9;
  border: 1px solid #e0e0e0;
  border-radius: 4px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 1px 1px 0 rgba(0,0,0,.08);
}
.news-popup-item h3 {
  margin-top: 0;
  color: #5c6bc0;
}
.news-popup-item p {
  color: #555;
  line-height: 1.5;
}
.news-popup-item small {
  font-size: 0.8em;
  color: #888;
  display: block;
  margin-top: 10px;
}
.news-popup-item img {
  max-width: 100%;
  height: auto;
  margin-top: 10px;
  border-radius: 4px;
}
.article-card {
  background: #fff;
  border-radius: 6px;
  padding: 12px;
  margin-bottom: 10px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.article-card h3 {
  margin: 0 0 6px 0;
}
.view-button {
  background-color: #3f51b5;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9em;
}
.view-button:hover {
  background-color: #303f9f;
}
#article-list, #article-details {
  padding: 15px;
  flex-grow: 1;
  overflow-y: auto;
  background: white;
  border-radius: 8px;
  margin: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
#article-details {
  display: none;
}
</style>

<script>
// Redirecionamento para navegadores não-Chromium
(function() {
  const userAgent = navigator.userAgent;
  const isChromium = !!window.chrome && userAgent.indexOf('Chrome') > -1 && userAgent.indexOf('Edg') === -1 && userAgent.indexOf('OPR') === -1;
  if (!isChromium) {
    window.location.href = './notchromium';
  }
})();

// Redirecionamento para mobile
(function() {
  const isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || (window.innerWidth <= 768);
  if (isMobile) {
    window.location.href = './mobile/index.html';
  }
})();
</script>

</head>
<body>

<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
  <header class="mdl-layout__header">
    <div class="mdl-layout__header-row">
      <a href="https://wikizero.wzzm.org/" id="home-link" style="display:flex; align-items:center; text-decoration:none;">
        <img src="https://wzzm.org/wnp.png" alt="Logo Wiki Zone Zero Mod" style="height: 32px; vertical-align: middle; margin-right: 8px;">
        <span class="mdl-layout-title" id="wiki-page-name">Carregando...</span>
      </a>
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation" style="display:flex; align-items:center;">
        <button class="mdl-button mdl-js-button mdl-button--icon" id="error-log-button" title="Ver Erros">
          <i class="material-icons">bug_report</i>
        </button>
        <a class="mdl-navigation__link" href="#" id="search-articles-link" onclick="createFloatingWindow('ferramentasuteis.html', null, false)">Procurar Artigos</a>

        <button class="mdl-button mdl-js-button mdl-button--icon" id="news-button" title="Últimas Notícias" style="display:none;">
          <i class="material-icons">article</i>
        </button>
        <div id="news-center-popup">
          <div id="news-popup-header">
            <span>Últimas Notícias</span>
            <button class="close-button" id="close-news-popup-button">&times;</button>
          </div>
          <div id="news-popup-content">
            <p>Carregando últimas notícias...</p>
          </div>
          <div id="news-popup-footer">
            <button id="view-all-news-button" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">Ver todas as Notícias</button>
          </div>
        </div>

        <button class="mdl-button mdl-js-button mdl-button--icon" id="google-apps-button" title="Serviços WZZM" style="display:none;">
          <i class="material-icons">widgets</i>
        </button>
        <div id="google-apps-popup">
          <h4>Serviços WZZM</h4>
          <div id="app-grid"></div>
        </div>

        <div id="user-info-container" style="display:none; align-items:center; color:white; margin-left: 10px;">
          <span id="user-info" style="margin-left: 8px;"></span>
          <img id="user-profile-pic" src="" alt="Profile Pic" />
          <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="logout-button" style="margin-left: 10px; display:none;">Sair</button>
        </div>

        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="login-google">Login Google</button>
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="login-github" style="margin-left: 10px;">Login GitHub</button>
      </nav>
    </div>
  </header>

  <div class="mdl-layout__drawer">
    <span class="mdl-layout-title" id="drawer-title">Navegação</span>
    <nav class="mdl-navigation" id="drawer-menu">
      <!-- Links podem ser adicionados aqui -->
    </nav>
  </div>

  <main class="mdl-layout__content">
    <iframe id="main-content-frame" src="home.html" frameborder="0" scrolling="auto"></iframe>
    <div id="window-container"></div>
  </main>
</div>

<div id="access-denied-message">Acesso negado.</div>
<div id="banned-message">Usuário banido.</div>

<!-- Firebase e scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://code.getmdl.io/1.3.0/material.min.js"></script>

<script>
  // Configuração Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD1LxOyVxtAxr5vhUdUkqu-JiPUko3u7iM",
    authDomain: "wikizero.firebaseapp.com",
    projectId: "wikizero",
    storageBucket: "wikizero.appspot.com",
    messagingSenderId: "470167573493",
    appId: "1:470167573493:web:622e4f40e5d6d31f6ca310",
    measurementId: "G-YR31DJ67SN"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Função para criar janela flutuante
  function createFloatingWindow(url, title = "Janela", maximized = false) {
    const container = document.getElementById('window-container');
    const win = document.createElement('div');
    win.className = 'floating-window';
    if (maximized) {
      win.style.top = "0";
      win.style.left = "0";
      win.style.width = "100%";
      win.style.height = "100%";
      win.style.borderRadius = "0";
    }
    win.innerHTML = `
      <div class="window-header">
        <span>${title}</span>
        <div class="window-controls">
          <button title="Fechar" onclick="this.closest('.floating-window').remove()">×</button>
        </div>
      </div>
      <div class="window-body">
        <iframe src="${url}"></iframe>
      </div>
    `;
    container.appendChild(win);

    // Tornar janela arrastável
    const header = win.querySelector('.window-header');
    let isDragging = false, offsetX, offsetY;

    header.addEventListener('mousedown', e => {
      isDragging = true;
      offsetX = e.clientX - win.offsetLeft;
      offsetY = e.clientY - win.offsetTop;
      header.style.cursor = 'grabbing';
    });
    document.addEventListener('mouseup', e => {
      isDragging = false;
      header.style.cursor = 'grab';
    });
    document.addEventListener('mousemove', e => {
      if (isDragging) {
        win.style.left = (e.clientX - offsetX) + 'px';
        win.style.top = (e.clientY - offsetY) + 'px';
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function () {
    // Atualiza título
    document.getElementById('wiki-page-name').textContent = 'Wiki Zone Zero Mod';

    // Botões login
    const loginGoogleButton = document.getElementById('login-google');
    const loginGithubButton = document.getElementById('login-github');
    const logoutButton = document.getElementById('logout-button');
    const userInfoContainer = document.getElementById('user-info-container');
    const userInfoSpan = document.getElementById('user-info');
    const userProfilePic = document.getElementById('user-profile-pic');

    loginGoogleButton.addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(error => {
        console.error("Erro no login Google:", error);
        alert("Erro ao fazer login com Google.");
      });
    });

    loginGithubButton.addEventListener('click', () => {
      const provider = new firebase.auth.GithubAuthProvider();
      auth.signInWithPopup(provider).catch(error => {
        console.error("Erro no login GitHub:", error);
        alert("Erro ao fazer login com GitHub.");
      });
    });

    logoutButton.addEventListener('click', () => {
      auth.signOut();
    });

    // Gerenciamento estado de autenticação
    auth.onAuthStateChanged(user => {
      if (user) {
        // Usuário logado
        loginGoogleButton.style.display = 'none';
        loginGithubButton.style.display = 'none';
        logoutButton.style.display = 'inline-block';
        userInfoContainer.style.display = 'flex';
        userInfoSpan.textContent = user.displayName || user.email || "Usuário";
        if (user.photoURL) {
          userProfilePic.src = user.photoURL;
          userProfilePic.style.display = 'inline-block';
        } else {
          userProfilePic.style.display = 'none';
        }
      } else {
        // Usuário deslogado
        loginGoogleButton.style.display = 'inline-block';
        loginGithubButton.style.display = 'inline-block';
        logoutButton.style.display = 'none';
        userInfoContainer.style.display = 'none';
      }
    });

    // Google Apps Popup
    const googleAppsButton = document.getElementById('google-apps-button');
    const googleAppsPopup = document.getElementById('google-apps-popup');
    googleAppsButton.style.display = 'inline-block';

    googleAppsButton.addEventListener('click', () => {
      if (googleAppsPopup.style.display === 'block') {
        googleAppsPopup.style.display = 'none';
      } else {
        googleAppsPopup.style.display = 'block';
      }
    });

    // Fechar popup ao clicar fora
    document.addEventListener('click', (e) => {
      if (!googleAppsPopup.contains(e.target) && e.target !== googleAppsButton) {
        googleAppsPopup.style.display = 'none';
      }
    });

    // Definir apps no Google Apps Popup
    const apps = [
      { name: 'WZZM', icon: 'https://wzzm.org/wzzm_logo.png', url: 'https://wzzm.org/' },
      { name: 'Drive', icon: 'https://wzzm.org/drive_icon.png', url: 'https://drive.wzzm.org' },
      { name: 'YouTube', icon: 'https://wzzm.org/youtube_icon.png', url: 'https://www.youtube.com/channel/UCn7IYbq3nCC-E6HvlryP2Eg' },
      { name: 'Map', icon: 'https://wzzm.org/map_icon.png', url: 'https://maps.wzzm.org' },
      { name: 'Wiki', icon: 'https://wzzm.org/wiki_icon.png', url: 'https://wiki.wzzm.org' },
      { name: 'Translate', icon: 'https://wzzm.org/translate_icon.png', url: 'https://translate.wzzm.org' },
      { name: 'Chat', icon: 'https://wzzm.org/chat_icon.png', url: 'https://chat.wzzm.org' },
      { name: 'News', icon: 'https://wzzm.org/news_icon.png', url: 'https://news.wzzm.org' },
      { name: 'Tools', icon: 'https://wzzm.org/tools_icon.png', url: 'https://tools.wzzm.org' },
    ];

    const appGrid = document.getElementById('app-grid');
    apps.forEach(app => {
      const appItem = document.createElement('div');
      appItem.className = 'app-item';
      appItem.title = app.name;
      appItem.innerHTML = `
        <img src="${app.icon}" alt="${app.name}" />
        <span>${app.name}</span>
      `;
      appItem.addEventListener('click', () => {
        window.open(app.url, '_blank');
      });
      appGrid.appendChild(appItem);
    });

    // News Popup (Exemplo de controle simples)
    const newsButton = document.getElementById('news-button');
    const newsCenterPopup = document.getElementById('news-center-popup');
    const closeNewsPopupButton = document.getElementById('close-news-popup-button');
    const viewAllNewsButton = document.getElementById('view-all-news-button');
    const newsPopupContent = document.getElementById('news-popup-content');

    // Se quiser ativar o botão notícias, descomente:
    // newsButton.style.display = 'inline-block';

    newsButton.addEventListener('click', () => {
      if (newsCenterPopup.style.display === 'flex') {
        newsCenterPopup.style.display = 'none';
      } else {
        newsCenterPopup.style.display = 'flex';
      }
    });

    closeNewsPopupButton.addEventListener('click', () => {
      newsCenterPopup.style.display = 'none';
    });

    viewAllNewsButton.addEventListener('click', () => {
      window.open('https://news.wzzm.org', '_blank');
    });

    // Exemplo de carregamento simples de notícias
    function loadNews() {
      newsPopupContent.innerHTML = '';
      const exampleNews = [
        { title: 'Nova versão do Wiki lançada', content: 'Atualização com melhorias e correções.', date: '04/09/2025' },
        { title: 'Evento WZZM ao vivo', content: 'Não perca a transmissão no YouTube.', date: '03/09/2025' }
      ];

      exampleNews.forEach(news => {
        const newsItem = document.createElement('div');
        newsItem.className = 'news-popup-item';
        newsItem.innerHTML = `
          <h3>${news.title}</h3>
          <p>${news.content}</p>
          <small>${news.date}</small>
        `;
        newsPopupContent.appendChild(newsItem);
      });
    }

    loadNews();
  });
</script>

</body>
</html>
