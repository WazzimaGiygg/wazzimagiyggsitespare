<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Conteúdo - Wazzimagiyggfemboyverse69</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background-color: #f4f4f4; }
        .container { max-width: 900px; margin: auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .setor-container { margin-top: 20px; border: 1px solid #ddd; border-radius: 5px; padding: 15px; background-color: #fafafa; }
        .setor-header { font-size: 1.5em; font-weight: bold; cursor: pointer; color: #555; display: flex; justify-content: space-between; align-items: center; }
        .setor-header:hover { color: #007bff; }
        .content-list { margin-top: 10px; padding-left: 20px; display: none; }
        .content-item { margin-top: 5px; cursor: pointer; color: #007bff; }
        .content-item:hover { text-decoration: underline; }
        .content-details { margin-top: 20px; padding: 15px; border: 1px solid #ccc; background-color: #fff; border-radius: 5px; }
        .content-title { font-size: 1.8em; font-weight: bold; margin-bottom: 10px; }
        .content-meta { font-size: 0.9em; color: #888; margin-bottom: 15px; }
        .content-body { margin-top: 15px; line-height: 1.6; }
        .content-body img { max-width: 100%; height: auto; }
        .loading { text-align: center; color: #555; }
        .expand-icon { transition: transform 0.2s; }
        .expanded .expand-icon { transform: rotate(90deg); }
    </style>
</head>
<body>

    <div class="container">
        <h1>Conteúdo por Setor</h1>
        
        <div id="loading" class="loading">Carregando conteúdo...</div>
        <div id="setor-list"></div>
        <div id="content-display"></div>
    </div>

    <script>
        // --- Configuração do Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
            authDomain: "wzzm-ce3fc.firebaseapp.com",
            projectId: "wzzm-ce3fc",
            storageBucket: "wzzm-ce3fc.appspot.com",
            messagingSenderId: "249427877153",
            appId: "1:249427877153:web:0e4297294794a5aadeb260",
            measurementId: "G-PLKNZNFCQ8"
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const setorList = document.getElementById('setor-list');
        const contentDisplay = document.getElementById('content-display');
        const loading = document.getElementById('loading');

        // Função para buscar e exibir o conteúdo
        const fetchContent = async () => {
            try {
                // Busca todos os documentos da coleção principal
                const snapshot = await db.collection('wazzimagiyggfemboyverse69').get();
                const contents = [];
                snapshot.forEach(doc => {
                    contents.push({ id: doc.id, ...doc.data() });
                });

                // Agrupa o conteúdo por setor
                const groupedBySector = contents.reduce((acc, current) => {
                    const setor = current.sector || 'Sem Setor';
                    if (!acc[setor]) {
                        acc[setor] = [];
                    }
                    acc[setor].push(current);
                    return acc;
                }, {});

                // Limpa a tela de carregamento
                loading.style.display = 'none';
                setorList.innerHTML = '';
                contentDisplay.innerHTML = '';

                // Renderiza a lista de setores e conteúdos
                for (const setor in groupedBySector) {
                    const setorDiv = document.createElement('div');
                    setorDiv.classList.add('setor-container');
                    
                    const setorHeader = document.createElement('div');
                    setorHeader.classList.add('setor-header');
                    setorHeader.innerHTML = `<span>${setor}</span><span class="expand-icon">></span>`;
                    setorDiv.appendChild(setorHeader);

                    const contentList = document.createElement('ul');
                    contentList.classList.add('content-list');
                    setorDiv.appendChild(contentList);

                    setorHeader.addEventListener('click', () => {
                        contentList.style.display = contentList.style.display === 'block' ? 'none' : 'block';
                        setorHeader.classList.toggle('expanded');
                    });
                    
                    groupedBySector[setor].forEach(item => {
                        const contentItem = document.createElement('li');
                        contentItem.classList.add('content-item');
                        contentItem.textContent = item.title;
                        contentList.appendChild(contentItem);
                        
                        contentItem.addEventListener('click', () => showContent(item));
                    });

                    setorList.appendChild(setorDiv);
                }

            } catch (error) {
                console.error("Erro ao buscar o conteúdo: ", error);
                loading.textContent = "Ocorreu um erro ao carregar o conteúdo.";
            }
        };

        // Função para exibir o conteúdo detalhado
        const showContent = async (item) => {
            contentDisplay.innerHTML = `<div class="content-details">
                <div class="content-title">${item.title}</div>
                <div class="content-meta">
                    Publicado em: ${item.date ? new Date(item.date.toDate()).toLocaleString() : 'N/A'} por Autor UID: ${item.author_uid}
                </div>
                <div class="content-body">${item.content}</div>
            </div>`;

            // Verifica se há uma imagem para renderizar
            if (item.image_reference && item.image_reference.startsWith('[IMAGEM_ID:')) {
                const imageDocId = item.image_reference.split(':')[1].replace(']', '');
                try {
                    const imageDoc = await db.collection('imagenscode').doc(imageDocId).get();
                    if (imageDoc.exists) {
                        const imageData = imageDoc.data();
                        const imageElement = document.createElement('img');
                        imageElement.src = `data:image/jpeg;base64,${imageData.base64_code}`;
                        imageElement.alt = imageData.original_name;
                        contentDisplay.querySelector('.content-body').appendChild(imageElement);
                    } else {
                        console.error('Imagem não encontrada:', imageDocId);
                    }
                } catch (error) {
                    console.error('Erro ao buscar imagem:', error);
                }
            }
        };

        // Inicia a busca do conteúdo quando a página carrega
        window.onload = fetchContent;
    </script>
</body>
</html>
